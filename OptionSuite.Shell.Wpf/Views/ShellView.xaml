<UserControl x:Class="OptionSuite.Shell.Wpf.Views.ShellView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:views="clr-namespace:OptionSuite.Shell.Wpf.Views"
             xmlns:infra="clr-namespace:OptionSuite.Shell.Wpf.Infrastructure"
             Background="{StaticResource Brush.Bg}">

    <UserControl.Resources>
        <!-- Fas 1: visuell selection + enkel view-switch (ingen VM) -->
        <infra:ModuleSelectedToTagConverter x:Key="Conv.ModuleSelectedToTag"/>
        <infra:ModuleIdToViewConverter x:Key="Conv.ModuleIdToView"/>
    </UserControl.Resources>

    <!-- Root: background + glows + content overlay -->
    <Grid Background="{StaticResource Brush.Bg}"
          infra:ShellSelection.SelectedModule="Blotter">

        <!-- ========== Radial glows (HTML-look) ========== -->
        <Rectangle IsHitTestVisible="False">
            <Rectangle.Fill>
                <RadialGradientBrush Center="0.25,0.15"
                                     GradientOrigin="0.25,0.15"
                                     RadiusX="0.9"
                                     RadiusY="0.9">
                    <GradientStop Color="{StaticResource Color.Glow.Accent}" Offset="0"/>
                    <GradientStop Color="{StaticResource Color.Transparent}" Offset="1"/>
                </RadialGradientBrush>
            </Rectangle.Fill>
        </Rectangle>

        <Rectangle IsHitTestVisible="False">
            <Rectangle.Fill>
                <RadialGradientBrush Center="0.85,0.00"
                                     GradientOrigin="0.85,0.00"
                                     RadiusX="0.7"
                                     RadiusY="0.7">
                    <GradientStop Color="{StaticResource Color.Glow.Good}" Offset="0"/>
                    <GradientStop Color="{StaticResource Color.Transparent}" Offset="1"/>
                </RadialGradientBrush>
            </Rectangle.Fill>
        </Rectangle>

        <!-- ========== Actual shell layout ========== -->
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="44"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- =================== Title bar =================== -->
            <Border Grid.Row="0"
                    BorderThickness="0">

                <Grid>
                    <!-- Title chrome -->
                    <Border Background="{StaticResource Brush.PanelChrome}"
                            Opacity="{StaticResource Opacity.Chrome.Title}"/>

                    <!-- Matcha layouten: rail=240, content=* -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="240"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Separator ONLY under content (inte under rail) -->
                        <Border Grid.Column="1"
                                BorderBrush="{StaticResource Brush.Border}"
                                BorderThickness="0,0,0,1"/>

                        <!-- Drag-zon + window buttons -->
                        <Grid x:Name="TitleBar"
                              Grid.ColumnSpan="2"
                              Background="Transparent"
                              MouseLeftButtonDown="HandleTitleBarMouseLeftButtonDown">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Orientation="Horizontal"
                                        VerticalAlignment="Center"
                                        Margin="12,0,0,0">
                                <TextBlock Text="FX.OptionSuite"
                                           FontWeight="SemiBold"
                                           FontSize="14"/>
                                <TextBlock Text="  •  Trading Shell"
                                           Foreground="{StaticResource Brush.TextMuted}"
                                           Margin="8,0,0,0"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1"
                                        Orientation="Horizontal"
                                        VerticalAlignment="Center"
                                        Margin="0,0,8,0">
                                <Button Style="{StaticResource WinGlyphButton}"
                                        Content="—"
                                        ToolTip="Minimize"
                                        Click="HandleMinimizeClick"/>

                                <Button Style="{StaticResource WinGlyphButton}"
                                        Content="▢"
                                        ToolTip="Maximize / Restore"
                                        Click="HandleMaxRestoreClick"/>

                                <Button Style="{StaticResource WinGlyphButton}"
                                        Content="✕"
                                        ToolTip="Close"
                                        Click="HandleCloseClick"/>
                            </StackPanel>
                        </Grid>
                    </Grid>
                </Grid>
            </Border>

            <!-- =================== Main layout =================== -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="240"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Left rail -->
                <Border Grid.Column="0"
                        Style="{StaticResource Style.LeftRail}">

                    <!-- Chrome overlay + content -->
                    <Grid>
                        <!-- Chrome overlay (subtil highlight) -->
                        <Border Background="{StaticResource Brush.PanelChrome}"
                                Opacity="{StaticResource Opacity.Chrome.Rail}"/>

                        <!-- Existing content -->
                        <DockPanel Margin="10">

                            <!-- Rail top -->
                            <Grid DockPanel.Dock="Top" Height="54">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="Modules"
                                           VerticalAlignment="Center"
                                           FontWeight="SemiBold"/>

                                <!-- Settings button (Fas 1: disabled) -->
                                <Button Grid.Column="1"
                                        Style="{StaticResource Style.IconSquareButton}"
                                        IsEnabled="False"
                                        ToolTip="Settings (coming later)">
                                    <TextBlock Text="⚙" FontSize="16"/>
                                </Button>
                            </Grid>

                            <!-- Module list (Fas 1: visuell selection) -->
                            <StackPanel>

                                <!-- Blotter -->
                                <Button Style="{StaticResource Style.ModuleButton}"
                                        Click="HandleModuleClick"
                                        CommandParameter="Blotter"
                                        Margin="0,0,0,10">
                                    <Button.Tag>
                                        <MultiBinding Converter="{StaticResource Conv.ModuleSelectedToTag}">
                                            <Binding Source="{x:Static infra:ShellModuleId.Blotter}"/>
                                            <Binding Path="(infra:ShellSelection.SelectedModule)"
                                                     RelativeSource="{RelativeSource AncestorType=UserControl}"/>
                                        </MultiBinding>
                                    </Button.Tag>

                                    <StackPanel>
                                        <TextBlock Text="Blotter"
                                                   FontWeight="SemiBold"
                                                   Foreground="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}"/>
                                        <TextBlock Text="Trades, filters, workflow"
                                                   Foreground="{StaticResource Brush.TextMuted2}"
                                                   FontSize="12"
                                                   Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>

                                <!-- Pricing -->
                                <Button Style="{StaticResource Style.ModuleButton}"
                                        Click="HandleModuleClick"
                                        CommandParameter="Pricing"
                                        Margin="0,0,0,10">
                                    <Button.Tag>
                                        <MultiBinding Converter="{StaticResource Conv.ModuleSelectedToTag}">
                                            <Binding Source="{x:Static infra:ShellModuleId.Pricing}"/>
                                            <Binding Path="(infra:ShellSelection.SelectedModule)"
                                                     RelativeSource="{RelativeSource AncestorType=UserControl}"/>
                                        </MultiBinding>
                                    </Button.Tag>

                                    <StackPanel>
                                        <TextBlock Text="Pricing"
                                                   FontWeight="SemiBold"
                                                   Foreground="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}"/>
                                        <TextBlock Text="RFQs, mid/curve, what-if"
                                                   Foreground="{StaticResource Brush.TextMuted2}"
                                                   FontSize="12"
                                                   Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>

                                <!-- Gamma Hedger -->
                                <Button Style="{StaticResource Style.ModuleButton}"
                                        Click="HandleModuleClick"
                                        CommandParameter="GammaHedger"
                                        Margin="0,0,0,10">
                                    <Button.Tag>
                                        <MultiBinding Converter="{StaticResource Conv.ModuleSelectedToTag}">
                                            <Binding Source="{x:Static infra:ShellModuleId.GammaHedger}"/>
                                            <Binding Path="(infra:ShellSelection.SelectedModule)"
                                                     RelativeSource="{RelativeSource AncestorType=UserControl}"/>
                                        </MultiBinding>
                                    </Button.Tag>

                                    <StackPanel>
                                        <TextBlock Text="Gamma Hedger"
                                                   FontWeight="SemiBold"
                                                   Foreground="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}"/>
                                        <TextBlock Text="Exposure, hedges, alerts"
                                                   Foreground="{StaticResource Brush.TextMuted2}"
                                                   FontSize="12"
                                                   Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>

                                <!-- Volatility Manager -->
                                <Button Style="{StaticResource Style.ModuleButton}"
                                        Click="HandleModuleClick"
                                        CommandParameter="VolatilityManager">
                                    <Button.Tag>
                                        <MultiBinding Converter="{StaticResource Conv.ModuleSelectedToTag}">
                                            <Binding Source="{x:Static infra:ShellModuleId.VolatilityManager}"/>
                                            <Binding Path="(infra:ShellSelection.SelectedModule)"
                                                     RelativeSource="{RelativeSource AncestorType=UserControl}"/>
                                        </MultiBinding>
                                    </Button.Tag>

                                    <StackPanel>
                                        <TextBlock Text="Volatility Manager"
                                                   FontWeight="SemiBold"
                                                   Foreground="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}"/>
                                        <TextBlock Text="Surfaces, snapshots, publish"
                                                   Foreground="{StaticResource Brush.TextMuted2}"
                                                   FontSize="12"
                                                   Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Button>

                            </StackPanel>

                        </DockPanel>
                    </Grid>
                </Border>

                <!-- Main host area -->
                <Border Grid.Column="1"
                        Background="{StaticResource Brush.Bg}"
                        Padding="{StaticResource Thickness.WindowPadding}">

                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- App header (Fas 1: statiskt exempel) -->
                        <Border Grid.Row="0"
                                Style="{StaticResource Style.Card}"
                                Padding="{StaticResource Spacing.Card}">
                            <StackPanel>
                                <TextBlock Text="Trade Blotter"
                                           FontWeight="SemiBold"
                                           FontSize="14"/>
                                <TextBlock Text="Underappens yta (layout och theme). Innehåll kommer senare."
                                           Foreground="{StaticResource Brush.TextMuted}"
                                           FontSize="12"
                                           Margin="0,3,0,0"/>
                            </StackPanel>
                        </Border>

                        <!-- Content host -->
                        <Border Grid.Row="1"
                                Margin="0,10,0,0"
                                Style="{StaticResource Style.Card}"
                                Padding="{StaticResource Spacing.Card}">

                            <ContentPresenter Margin="12"
                                              Content="{Binding RelativeSource={RelativeSource AncestorType=UserControl},
                                                                Path=(infra:ShellSelection.SelectedModule),
                                                                Converter={StaticResource Conv.ModuleIdToView}}"/>

                        </Border>
                    </Grid>
                </Border>

            </Grid>
        </Grid>
    </Grid>
</UserControl>
